#!/usr/bin/env bash

# ------------------------------------------------------------------------------
#
#   Generate index file APKINDEX.tar.gz
#
# ------------------------------------------------------------------------------

# set -e : Exit the script if any statement returns a non-true return value.
# set -u : Exit the script when using uninitialised variable.
set -eu

# cd to package folder
cd "/public/v$ALPINE_VERSION/$ALPINE_ARCH"

# Create APKINDEX.tar.gz file
apk index -vU -o APKINDEX.tar.gz *.apk

# Sign APKINDEX.tar.gz file
abuild-sign -k $PACKAGER_PRIVKEY -p $RSA_KEY_NAME.pub APKINDEX.tar.gz

# Update permissions
sudo chmod 644 APKINDEX.tar.gz
